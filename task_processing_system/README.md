# â˜• éåŒæœŸã‚¿ã‚¹ã‚¯å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ  (Java)

Javaã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ã‚’ä½¿ã£ãŸã€é«˜åº¦ãªéåŒæœŸã‚¿ã‚¹ã‚¯å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³ã€‚
ExecutorServiceã¨BlockingQueueã‚’é§†ä½¿ã—ãŸã€å®Ÿå‹™ã§ä½¿ãˆã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚

## âœ¨ æ©Ÿèƒ½

### ã‚³ã‚¢æ©Ÿèƒ½
- **ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ä¸¦è¡Œå‡¦ç†**: ExecutorServiceã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ç®¡ç†
- **å„ªå…ˆåº¦ä»˜ãã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼**: PriorityBlockingQueueã§é‡è¦ãªã‚¿ã‚¹ã‚¯ã‚’å„ªå…ˆå‡¦ç†
- **è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹**: æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã«ã‚ˆã‚‹è³¢ã„ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥
- **ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: Pub/Subãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®ç–çµåˆãªè¨­è¨ˆ
- **ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•**: ConcurrentHashMapã¨Atomicã‚¯ãƒ©ã‚¹ã§å®‰å…¨ãªä¸¦è¡Œå‡¦ç†

### é«˜åº¦ãªæ©Ÿèƒ½
- **ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ç®¡ç†**: QUEUED â†’ RUNNING â†’ COMPLETED/FAILED ã®è¿½è·¡
- **çµ±è¨ˆæƒ…å ±åé›†**: æˆåŠŸç‡ã€ãƒªãƒˆãƒ©ã‚¤å›æ•°ã€å‡¦ç†æ™‚é–“ã®æ¸¬å®š
- **ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³**: å®‰å…¨ãªçµ‚äº†å‡¦ç†
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒ¼ãƒˆ**: ã‚¿ã‚¹ã‚¯ã«ä»»æ„ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä»˜ä¸å¯èƒ½
- **éåŒæœŸã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡**: ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ãŒæœ¬ä½“ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„

## ğŸ¯ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿå‹™ã‚·ãƒ¼ãƒ³ã§ä½¿ãˆã¾ã™:

- **ECã‚µã‚¤ãƒˆã®æ³¨æ–‡å‡¦ç†**: åœ¨åº«ç¢ºèª â†’ æ±ºæ¸ˆ â†’ é…é€æ‰‹é…
- **ãƒãƒƒãƒå‡¦ç†**: å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®ä¸¦è¡Œå‡¦ç†
- **ã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼**: é‡ã„ã‚¿ã‚¹ã‚¯ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œ
- **ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **APIçµ±åˆ**: å¤–éƒ¨APIã®ä¸¦è¡Œå‘¼ã³å‡ºã—

## ğŸ“¦ å¿…è¦ãªã‚‚ã®

```bash
# Javaãƒãƒ¼ã‚¸ãƒ§ãƒ³
Java 8ä»¥ä¸Š (Java 11ä»¥ä¸Šæ¨å¥¨)

# ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
ãªã—ï¼ˆæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ï¼‰
```

## ğŸš€ èµ·å‹•æ–¹æ³•

### 1. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
task_processing_system/
â””â”€â”€ com/
    â””â”€â”€ taskprocessing/
        â”œâ”€â”€ Main.java                  # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
        â”œâ”€â”€ TaskProcessor.java         # ã‚¿ã‚¹ã‚¯å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³
        â”œâ”€â”€ TaskQueue.java             # å„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼
        â”œâ”€â”€ EventBus.java              # ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹
        â””â”€â”€ models/
            â””â”€â”€ Task.java              # ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹ç¾¤
```

### 2. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

```bash
# ã‚½ãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd task_processing_system

# ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼ˆbinãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å‡ºåŠ›ï¼‰
javac -d bin com/taskprocessing/*.java com/taskprocessing/models/*.java

# ã¾ãŸã¯å…¨ãƒ•ã‚¡ã‚¤ãƒ«ä¸€æ‹¬ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
find . -name "*.java" | xargs javac -d bin
```

### 3. å®Ÿè¡Œ

```bash
# å®Ÿè¡Œ
java -cp bin com.taskprocessing.Main
```

### 4. å®Ÿè¡Œçµæœä¾‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   éåŒæœŸã‚¿ã‚¹ã‚¯å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ  - ECæ³¨æ–‡å‡¦ç†ãƒ‡ãƒ¢           â•‘
â•‘   Multi-threaded Task Processing System                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†

ğŸ“Š ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰æ•°: 4
âš™ï¸  ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½: æœ‰åŠ¹
ğŸ”” ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥: æœ‰åŠ¹

============================================================

ğŸ“¦ 5ä»¶ã®æ³¨æ–‡ã‚’æŠ•å…¥ã—ã¾ã—ãŸ

â–¶ï¸  [ORD-003] ã‚¿ã‚¹ã‚¯é–‹å§‹: æ³¨æ–‡å‡¦ç†: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ (å„ªå…ˆåº¦: URGENT)
  [ORD-003] ğŸ“¦ åœ¨åº«ç¢ºèªä¸­... (ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ Ã— 2)
â–¶ï¸  [ORD-001] ã‚¿ã‚¹ã‚¯é–‹å§‹: æ³¨æ–‡å‡¦ç†: ãƒãƒ¼ãƒˆPC (å„ªå…ˆåº¦: HIGH)
  [ORD-001] ğŸ“¦ åœ¨åº«ç¢ºèªä¸­... (ãƒãƒ¼ãƒˆPC Ã— 1)
â–¶ï¸  [ORD-002] ã‚¿ã‚¹ã‚¯é–‹å§‹: æ³¨æ–‡å‡¦ç†: ãƒã‚¦ã‚¹ (å„ªå…ˆåº¦: NORMAL)
  [ORD-002] ğŸ“¦ åœ¨åº«ç¢ºèªä¸­... (ãƒã‚¦ã‚¹ Ã— 100)
â–¶ï¸  [ORD-004] ã‚¿ã‚¹ã‚¯é–‹å§‹: æ³¨æ–‡å‡¦ç†: ãƒ¢ãƒ‹ã‚¿ãƒ¼ (å„ªå…ˆåº¦: NORMAL)
  [ORD-004] ğŸ“¦ åœ¨åº«ç¢ºèªä¸­... (ãƒ¢ãƒ‹ã‚¿ãƒ¼ Ã— 1)
  [ORD-003] ğŸ’³ æ±ºæ¸ˆå‡¦ç†ä¸­... (Â¥16,000)
ğŸ”„ [ORD-002] ãƒªãƒˆãƒ©ã‚¤ä¸­... (è©¦è¡Œå›æ•°: 1/3) ç†ç”±: åœ¨åº«ä¸è¶³
  [ORD-001] ğŸ’³ æ±ºæ¸ˆå‡¦ç†ä¸­... (Â¥150,000)
  [ORD-003] ğŸšš é…é€æ‰‹é…ä¸­...
âœ… [ORD-003] ã‚¿ã‚¹ã‚¯å®Œäº†: æ³¨æ–‡å®Œäº†: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ Ã— 2 (åˆè¨ˆ Â¥16,000)
  [ORD-002] ğŸ“¦ åœ¨åº«ç¢ºèªä¸­... (ãƒã‚¦ã‚¹ Ã— 100)
  [ORD-004] ğŸ’³ æ±ºæ¸ˆå‡¦ç†ä¸­... (Â¥30,000)
  [ORD-001] ğŸšš é…é€æ‰‹é…ä¸­...
âœ… [ORD-001] ã‚¿ã‚¹ã‚¯å®Œäº†: æ³¨æ–‡å®Œäº†: ãƒãƒ¼ãƒˆPC Ã— 1 (åˆè¨ˆ Â¥150,000)
...

============================================================

ğŸ“ˆ å‡¦ç†çµæœã‚µãƒãƒªãƒ¼
  âœ… æˆåŠŸ: 5ä»¶
  âŒ å¤±æ•—: 0ä»¶
  ğŸ“Š æˆåŠŸç‡: 100.0%

============================================================

ğŸ“Š å‡¦ç†çµ±è¨ˆ

  ç·ã‚¿ã‚¹ã‚¯æ•°: 5
  å®Œäº†: 5
  å¤±æ•—: 0
  ãƒªãƒˆãƒ©ã‚¤ç·æ•°: 2
  æˆåŠŸç‡: 100.0%

  çŠ¶æ…‹åˆ¥:
    COMPLETED: 5

ğŸ›‘ ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã—ã¦ã„ã¾ã™...
âœ… å…¨å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ
```

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Main.java                    â”‚
â”‚  - ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ                    â”‚
â”‚  - ãƒ‡ãƒ¢ã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TaskProcessor    â”‚  â”‚  EventBus          â”‚
â”‚                  â”‚  â”‚                    â”‚
â”‚ - ExecutorServiceâ”‚  â”‚  - Pub/Sub         â”‚
â”‚ - ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ     â”‚  â”‚  - ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡    â”‚
â”‚ - ãƒªãƒˆãƒ©ã‚¤åˆ¶å¾¡   â”‚  â”‚  - ãƒªã‚¹ãƒŠãƒ¼ç®¡ç†    â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TaskQueue        â”‚
â”‚                  â”‚
â”‚ - å„ªå…ˆåº¦ä»˜ã     â”‚
â”‚ - BlockingQueue  â”‚
â”‚ - ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ• â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¯ãƒ©ã‚¹å›³

```
Task
â”œâ”€â”€ id: String
â”œâ”€â”€ description: String
â”œâ”€â”€ priority: TaskPriority
â”œâ”€â”€ maxRetries: int
â”œâ”€â”€ executor: TaskExecutor
â””â”€â”€ metadata: Map<String, String>

TaskProcessor
â”œâ”€â”€ executorService: ExecutorService
â”œâ”€â”€ taskQueue: TaskQueue
â”œâ”€â”€ eventBus: EventBus
â”œâ”€â”€ submitTask(Task): Future<TaskResult>
â”œâ”€â”€ executeTask(Task): TaskResult
â””â”€â”€ shutdown(): void

TaskQueue
â”œâ”€â”€ queue: PriorityBlockingQueue<Task>
â”œâ”€â”€ enqueue(Task): void
â”œâ”€â”€ dequeue(): Task
â””â”€â”€ size(): int

EventBus (Singleton)
â”œâ”€â”€ listeners: Map<TaskEventType, List<Consumer>>
â”œâ”€â”€ subscribe(TaskEventType, Consumer): void
â”œâ”€â”€ publish(TaskEvent): void
â””â”€â”€ publishSync(TaskEvent): void
```

### å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. ã‚¿ã‚¹ã‚¯æŠ•å…¥
   â†“
2. TaskQueue ã«ã‚¨ãƒ³ã‚­ãƒ¥ãƒ¼ï¼ˆå„ªå…ˆåº¦é †ï¼‰
   â†“
3. ExecutorService ãŒãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œ
   â†“
4. ã‚¿ã‚¹ã‚¯é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
   â†“
5. ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ
   â”‚
   â”œâ”€ æˆåŠŸ â†’ å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ â†’ å®Œäº†
   â”‚
   â””â”€ å¤±æ•— â†’ ãƒªãƒˆãƒ©ã‚¤åˆ¤å®š
              â”‚
              â”œâ”€ ãƒªãƒˆãƒ©ã‚¤å¯ â†’ æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•å¾…æ©Ÿ â†’ å†å®Ÿè¡Œ
              â”‚
              â””â”€ ãƒªãƒˆãƒ©ã‚¤ä¸å¯ â†’ å¤±æ•—ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ â†’ å¤±æ•—
```

## ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```java
// 1. ãƒ—ãƒ­ã‚»ãƒƒã‚µåˆæœŸåŒ–ï¼ˆ4ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰ï¼‰
TaskProcessor processor = new TaskProcessor(4);

// 2. ã‚¿ã‚¹ã‚¯ä½œæˆ
Task task = new Task("TASK-001", "ãƒ‡ãƒ¼ã‚¿å‡¦ç†");
task.setPriority(TaskPriority.HIGH);
task.setMaxRetries(3);

// 3. å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯è¨­å®š
task.setExecutor(() -> {
    // ä½•ã‹å‡¦ç†
    System.out.println("å‡¦ç†å®Ÿè¡Œä¸­...");
    Thread.sleep(1000);
    
    // çµæœã‚’è¿”ã™
    return new TaskResult("TASK-001", true, "å‡¦ç†å®Œäº†");
});

// 4. ã‚¿ã‚¹ã‚¯æŠ•å…¥
Future<TaskResult> future = processor.submitTask(task);

// 5. çµæœå–å¾—ï¼ˆãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ï¼‰
TaskResult result = future.get();
System.out.println("çµæœ: " + result.getMessage());

// 6. ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³
processor.shutdown();
```

### ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç™»éŒ²

```java
EventBus eventBus = EventBus.getInstance();

// ã‚¿ã‚¹ã‚¯å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªãƒƒã‚¹ãƒ³
eventBus.subscribe(TaskEventType.TASK_COMPLETED, event -> {
    System.out.println("å®Œäº†: " + event.getTaskId());
});

// ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªãƒƒã‚¹ãƒ³
eventBus.subscribe(TaskEventType.TASK_FAILED, event -> {
    String error = event.getData().get("error");
    System.err.println("ã‚¨ãƒ©ãƒ¼: " + error);
    
    // é€šçŸ¥é€ä¿¡ã€ãƒ­ã‚°è¨˜éŒ²ãªã©
});
```

### ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¹ã‚¯ä½œæˆ

```java
public class DataProcessingTask {
    
    public static Task create(String id, List<String> dataList) {
        Task task = new Task(id, "ãƒ‡ãƒ¼ã‚¿å‡¦ç†");
        task.setPriority(TaskPriority.NORMAL);
        task.setMaxRetries(2);
        
        // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¨­å®š
        task.addMetadata("recordCount", String.valueOf(dataList.size()));
        task.addMetadata("processType", "batch");
        
        // å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯
        task.setExecutor(() -> {
            int processed = 0;
            
            for (String data : dataList) {
                // ãƒ‡ãƒ¼ã‚¿å‡¦ç†
                processData(data);
                processed++;
                
                // é€²æ—è¡¨ç¤º
                if (processed % 100 == 0) {
                    System.out.println("é€²æ—: " + processed + "/" + dataList.size());
                }
            }
            
            return new TaskResult(
                id, 
                true, 
                processed + "ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã—ã¾ã—ãŸ"
            );
        });
        
        return task;
    }
    
    private static void processData(String data) {
        // å®Ÿéš›ã®å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
    }
}

// ä½¿ç”¨ä¾‹
Task task = DataProcessingTask.create("BATCH-001", myDataList);
processor.submitTask(task);
```

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«æ•°ã®å¤‰æ›´

```java
// CPUã‚³ã‚¢æ•°ã«å¿œã˜ã¦è‡ªå‹•è¨­å®š
int threadCount = Runtime.getRuntime().availableProcessors();
TaskProcessor processor = new TaskProcessor(threadCount);
```

### å„ªå…ˆåº¦ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

`TaskPriority` enumã«æ–°ã—ã„å„ªå…ˆåº¦ã‚’è¿½åŠ :

```java
enum TaskPriority {
    CRITICAL(15),  // è¿½åŠ 
    URGENT(10),
    HIGH(8),
    NORMAL(5),
    LOW(1);
    
    // ...
}
```

### ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥ã®å¤‰æ›´

`TaskProcessor.executeTask()` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã®ãƒãƒƒã‚¯ã‚ªãƒ•æ™‚é–“ã‚’èª¿æ•´:

```java
// ç¾åœ¨: æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆ2^nç§’ã€æœ€å¤§10ç§’ï¼‰
long backoffTime = (long) (Math.pow(2, currentRetry - 1) * 1000);
backoffTime = Math.min(backoffTime, 10000);

// ã‚«ã‚¹ã‚¿ãƒ : å›ºå®š3ç§’å¾…æ©Ÿ
long backoffTime = 3000;

// ã‚«ã‚¹ã‚¿ãƒ : ç·šå½¢ãƒãƒƒã‚¯ã‚ªãƒ•
long backoffTime = currentRetry * 2000; // 2ç§’ã€4ç§’ã€6ç§’...
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

### 1. æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ

```java
// æˆåŠŸã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’æŠ•å…¥
Task task = new Task("TEST-001", "æ­£å¸¸ãƒ†ã‚¹ãƒˆ");
task.setExecutor(() -> {
    return new TaskResult("TEST-001", true, "æˆåŠŸ");
});

Future<TaskResult> future = processor.submitTask(task);
TaskResult result = future.get();

assert result.isSuccess();
```

### 2. ãƒªãƒˆãƒ©ã‚¤ãƒ†ã‚¹ãƒˆ

```java
AtomicInteger attemptCount = new AtomicInteger(0);

Task task = new Task("TEST-002", "ãƒªãƒˆãƒ©ã‚¤ãƒ†ã‚¹ãƒˆ");
task.setMaxRetries(3);
task.setExecutor(() -> {
    int attempt = attemptCount.incrementAndGet();
    
    // 2å›ç›®ã§æˆåŠŸ
    if (attempt < 2) {
        throw new RuntimeException("ä¸€æ™‚çš„ãªã‚¨ãƒ©ãƒ¼");
    }
    
    return new TaskResult("TEST-002", true, "æˆåŠŸ");
});

Future<TaskResult> future = processor.submitTask(task);
TaskResult result = future.get();

assert result.isSuccess();
assert attemptCount.get() == 2;
```

### 3. å„ªå…ˆåº¦ãƒ†ã‚¹ãƒˆ

```java
// ä½å„ªå…ˆåº¦ã‚¿ã‚¹ã‚¯
Task lowTask = new Task("LOW-001", "ä½å„ªå…ˆåº¦");
lowTask.setPriority(TaskPriority.LOW);

// é«˜å„ªå…ˆåº¦ã‚¿ã‚¹ã‚¯ï¼ˆå¾Œã‹ã‚‰æŠ•å…¥ï¼‰
Task highTask = new Task("HIGH-001", "é«˜å„ªå…ˆåº¦");
highTask.setPriority(TaskPriority.URGENT);

processor.submitTask(lowTask);
Thread.sleep(100);
processor.submitTask(highTask);

// HIGH-001ãŒå…ˆã«å®Ÿè¡Œã•ã‚Œã‚‹ã¯ãš
```

### 4. ä¸¦è¡Œå‡¦ç†ãƒ†ã‚¹ãƒˆ

```java
List<Future<TaskResult>> futures = new ArrayList<>();

// 100ã‚¿ã‚¹ã‚¯ã‚’ä¸¦è¡ŒæŠ•å…¥
for (int i = 0; i < 100; i++) {
    final int taskNum = i;
    Task task = new Task("TASK-" + i, "ä¸¦è¡Œãƒ†ã‚¹ãƒˆ");
    
    task.setExecutor(() -> {
        Thread.sleep(100);
        return new TaskResult("TASK-" + taskNum, true, "å®Œäº†");
    });
    
    futures.add(processor.submitTask(task));
}

// å…¨ã‚¿ã‚¹ã‚¯å®Œäº†å¾…æ©Ÿ
for (Future<TaskResult> future : futures) {
    future.get();
}

// å…¨ã¦æˆåŠŸã—ã¦ã„ã‚‹ã¯ãš
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœä¾‹

```
ã‚¿ã‚¹ã‚¯æ•°: 1000
ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«: 4
å¹³å‡å‡¦ç†æ™‚é–“: 50ms/ã‚¿ã‚¹ã‚¯

çµæœ:
- ç·å‡¦ç†æ™‚é–“: ç´„12.5ç§’
- ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ: ç´„80ã‚¿ã‚¹ã‚¯/ç§’
- æˆåŠŸç‡: 100%
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

1. **ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«æ•°**
   - CPUå¯†é›†å‹: CPUã‚³ã‚¢æ•°
   - I/Oå¯†é›†å‹: CPUã‚³ã‚¢æ•° Ã— 2ä»¥ä¸Š

2. **ã‚­ãƒ¥ãƒ¼å®¹é‡**
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ç„¡åˆ¶é™ï¼ˆPriorityBlockingQueueï¼‰
   - ãƒ¡ãƒ¢ãƒªåˆ¶ç´„ãŒã‚ã‚‹å ´åˆã¯æœ‰é™ã‚­ãƒ¥ãƒ¼ã‚’æ¤œè¨

3. **ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥**
   - çŸ­æ™‚é–“ã‚¨ãƒ©ãƒ¼: çŸ­ã„ãƒãƒƒã‚¯ã‚ªãƒ•
   - å¤–éƒ¨API: é•·ã‚ã®ãƒãƒƒã‚¯ã‚ªãƒ•

## ğŸ”’ ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãƒ†ã‚£

### ä½¿ç”¨ã—ã¦ã„ã‚‹ä¸¦è¡Œå‡¦ç†æ©Ÿæ§‹

| ã‚¯ãƒ©ã‚¹ | æ©Ÿæ§‹ | ç”¨é€” |
|--------|------|------|
| `TaskProcessor` | `ExecutorService` | ã‚¿ã‚¹ã‚¯ã®ä¸¦è¡Œå®Ÿè¡Œ |
| `TaskQueue` | `PriorityBlockingQueue` | ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªã‚­ãƒ¥ãƒ¼ |
| `EventBus` | `ConcurrentHashMap` | ãƒªã‚¹ãƒŠãƒ¼ç®¡ç† |
| çµ±è¨ˆæƒ…å ± | `AtomicInteger` | ã‚«ã‚¦ãƒ³ã‚¿ |
| ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ | `ConcurrentHashMap` | çŠ¶æ…‹ç®¡ç† |

### æ³¨æ„ç‚¹

- ã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯å†…ã§å…±æœ‰çŠ¶æ…‹ã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ã€é©åˆ‡ãªåŒæœŸãŒå¿…è¦
- `EventBus`ã®ãƒªã‚¹ãƒŠãƒ¼ã¯éåŒæœŸå®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€é †åºä¿è¨¼ãªã—

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œã•ã‚Œãªã„

```java
// åŸå› : ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã•ã‚Œã¦ã„ã‚‹
if (processor.isShutdown()) {
    System.err.println("ãƒ—ãƒ­ã‚»ãƒƒã‚µãŒã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã•ã‚Œã¦ã„ã¾ã™");
}

// è§£æ±º: æ–°ã—ã„ãƒ—ãƒ­ã‚»ãƒƒã‚µã‚’ä½œæˆ
processor = new TaskProcessor(4);
```

### OutOfMemoryError

```java
// åŸå› : ã‚¿ã‚¹ã‚¯ã®æŠ•å…¥é€Ÿåº¦ > å‡¦ç†é€Ÿåº¦

// è§£æ±º1: ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«æ•°ã‚’å¢—ã‚„ã™
TaskProcessor processor = new TaskProcessor(8);

// è§£æ±º2: ã‚¿ã‚¹ã‚¯æŠ•å…¥ã‚’ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°
for (Task task : tasks) {
    processor.submitTask(task);
    Thread.sleep(10); // é©åº¦ã«å¾…æ©Ÿ
}
```

### ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯

```java
// åŸå› : ã‚¿ã‚¹ã‚¯å†…ã§Future.get()ã‚’åŒæœŸçš„ã«å‘¼ã¶

task.setExecutor(() -> {
    // NG: åˆ¥ã®ã‚¿ã‚¹ã‚¯ã®å®Œäº†ã‚’å¾…ã¤ï¼ˆãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã®å¯èƒ½æ€§ï¼‰
    Future<TaskResult> otherFuture = processor.submitTask(otherTask);
    otherFuture.get(); // ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯!
    
    return new TaskResult(...);
});

// è§£æ±º: ã‚¿ã‚¹ã‚¯ã®ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤ºçš„ã«ç®¡ç†
```

## ğŸš€ æ‹¡å¼µã‚¢ã‚¤ãƒ‡ã‚¢

- [ ] **æ°¸ç¶šåŒ–**: ã‚¿ã‚¹ã‚¯ã‚’DBã«ä¿å­˜ï¼ˆå†èµ·å‹•å¾Œã‚‚ç¶™ç¶šï¼‰
- [ ] **åˆ†æ•£å‡¦ç†**: Redis/RabbitMQã§ã‚¯ãƒ©ã‚¹ã‚¿æ§‹æˆ
- [ ] **Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–UI
- [ ] **ã‚¿ã‚¹ã‚¯ã®ä¾å­˜é–¢ä¿‚**: DAGï¼ˆæœ‰å‘éå·¡å›ã‚°ãƒ©ãƒ•ï¼‰å¯¾å¿œ
- [ ] **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°**: Cronå¼ã§ã®ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ
- [ ] **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: é•·æ™‚é–“å®Ÿè¡Œã‚¿ã‚¹ã‚¯ã®å¼·åˆ¶çµ‚äº†
- [ ] **CircuitBreaker**: é€£ç¶šå¤±æ•—æ™‚ã®è‡ªå‹•åœæ­¢
- [ ] **ãƒ¡ãƒˆãƒªã‚¯ã‚¹**: Prometheus/Grafanaã§ã®å¯è¦–åŒ–

## ğŸ“š å‚è€ƒè³‡æ–™

- [Java Concurrency in Practice](https://jcip.net/)
- [ExecutorService Documentation](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html)
- [BlockingQueue Documentation](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html)
- [Concurrent Collections](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/package-summary.html)

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License - è‡ªç”±ã«ä½¿ã£ã¦OKï¼

---

**ä½œæˆè€…**: Claude  
**æ›´æ–°æ—¥**: 2025å¹´  
**é›£æ˜“åº¦**: â­â­â­â­â­ (ä¸Šç´šè€…å‘ã‘)  
**å®Ÿå‹™é©ç”¨åº¦**: â­â­â­â­â­ (ãã®ã¾ã¾ä½¿ãˆã‚‹ãƒ¬ãƒ™ãƒ«)
